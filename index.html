<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Furkatech Technology</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <!-- ===== FIREBASE LOADING INDICATOR ===== -->
    <div id="firebaseLoadingOverlay" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); z-index: 10000; align-items: center; justify-content: center;">
        <div style="background: white; padding: 30px; border-radius: 12px; text-align: center; max-width: 400px;">
            <div style="margin-bottom: 20px;">
                <i class="fas fa-database" style="font-size: 48px; color: #4285f4;"></i>
            </div>
            <h3 style="margin-bottom: 10px; color: #333;">Firebase Bağlanıyor</h3>
            <p style="color: #666; margin-bottom: 20px;">Veriler yükleniyor, lütfen bekleyin...</p>
            <div style="display: flex; justify-content: center; gap: 4px;">
                <div style="width: 8px; height: 8px; background: #4285f4; border-radius: 50%; animation: bounce 1.4s infinite ease-in-out;"></div>
                <div style="width: 8px; height: 8px; background: #4285f4; border-radius: 50%; animation: bounce 1.4s infinite ease-in-out 0.2s;"></div>
                <div style="width: 8px; height: 8px; background: #4285f4; border-radius: 50%; animation: bounce 1.4s infinite ease-in-out 0.4s;"></div>
            </div>
        </div>
    </div>

    <!-- LOGIN SCREEN -->
    <div id="loginContainer" class="login-container">
        <div class="login-card">
            <div class="login-header">
                <div class="logo">
                  <img src="img/logo/furkatech300.svg" alt="">
                </div>
                <h1>FZA-ERP</h1>
                <p>İşletme yönetim sisteminize hoş geldiniz</p>
                <!-- ===== FIREBASE STATUS INDICATOR ===== -->
                <div id="firebaseStatus" style="margin-top: 10px; padding: 8px 12px; border-radius: 6px; font-size: 12px; display: none;">
                    <i class="fas fa-database"></i>
                    <span id="firebaseStatusText">Firebase bağlantısı kontrol ediliyor...</span>
                </div>
            </div>
            <div class="login-form">
                <form id="loginForm">
                    <div class="form-group">
                        <label>Kullanıcı Adı</label>
                        <div class="input-wrapper">
                            <i class="fas fa-user"></i>
                            <input type="text" id="username" class="form-input" placeholder="furkan, ahmet vb." required>
                        </div>
                    </div>
                    <div class="form-group">
                        <label>Şifre</label>
                        <div class="input-wrapper">
                            <i class="fas fa-lock"></i>
                            <input type="password" id="password" class="form-input" placeholder="••••••••" required>
                        </div>
                    </div>
                    <button type="submit" class="login-btn" id="loginButton">
                        <i class="fas fa-sign-in-alt"></i>
                        Giriş Yap
                    </button>
                </form>
                <!-- ===== FIREBASE TEST USERS ===== -->
                <div style="margin-top: 20px; padding-top: 20px; border-top: 1px solid #eee;">
                    <p style="font-size: 12px; color: #666; margin-bottom: 10px;">Test Kullanıcıları:</p>
                    <div style="display: grid; gap: 8px; font-size: 11px; color: #777;">
                        <div>Admin: furkan / 123456</div>
                        <div>Üretim: AHMET / AHMET</div>
                        
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- MAIN APP -->
    <div id="appContainer" class="app-container">
        <!-- NAVBAR -->
        <nav class="navbar">
            <div class="navbar-brand">
                <div class="icon">
                    <a href="https://furkatechyazilim.net"><img src="img/logo/furkatech300.svg" alt=""></a>
                </div>
              <span>FZA-ERP</span></a>
                <!-- ===== FIREBASE SYNC INDICATOR ===== -->
                <div id="firebaseSyncIndicator" style="margin-left: 15px; font-size: 12px; color: #4285f4; display: none;">
                    <i class="fas fa-sync-alt fa-spin"></i>
                    <span>Senkronize ediliyor...</span>
                </div>
            </div>
            <div class="navbar-user">
                <button id="profileBtn" onclick="toggleUserProfile()" style="background: none; border: none; cursor: pointer; display: flex; align-items: center; gap: 8px; padding: 0;">
                    <div class="user-avatar" id="profileAvatar">
                        <span id="avatarText">K</span>
                    </div>
                    <span id="userName" class="font-medium">Kullanıcı</span>
                    <i class="fas fa-chevron-down" style="color: var(--gray-500);"></i>
                </button>
                <button class="notification-btn" onclick="showPage('bildirimler')" style="background: none; border: none; cursor: pointer; position: relative; margin-right: 15px;">
        <i class="fas fa-bell" style="font-size: 20px; color: var(--gray-600);"></i>
        <span id="notificationBadge" style="position: absolute; top: -5px; right: -5px; background: var(--danger); color: white; border-radius: 50%; width: 18px; height: 18px; display: none; font-size: 11px; line-height: 18px; text-align: center;"></span>
    </button>
                <div id="userProfilePanel">
                    <div onclick="showPage('profil'); toggleUserProfile();">
                        <i class="fas fa-user" style="margin-right: 8px;"></i>Profil
                    </div>
                    <div onclick="showPage('ayarlar'); toggleUserProfile();">
                        <i class="fas fa-cog" style="margin-right: 8px;"></i>Ayarlar
                    </div>
                    <div onclick="showPage('aktivite'); toggleUserProfile();">
                        <i class="fas fa-history" style="margin-right: 8px;"></i>Aktivite
                    </div>
                    <div onclick="logout()" style="color: var(--danger);">
                        <i class="fas fa-sign-out-alt" style="margin-right: 8px;"></i>Çıkış
                    </div>
                </div>
                <button class="logout-btn" onclick="logout()">
                    <i class="fas fa-sign-out-alt"></i>
                    Çıkış
                </button>
            </div>
        </nav>

        <!-- APP LAYOUT -->
        <div class="app-layout">
            <!-- SIDEBAR -->
            <aside class="sidebar">
    <nav class="sidebar-menu">
        <div class="menu-section">
            <div class="menu-section-title">Ana Menü</div>
            <div class="menu-item active" onclick="showPage('dashboard')">
                <i class="fas fa-chart-line"></i>
                <span>Ana Sayfa</span>
            </div>
        </div>

        <div class="menu-section">
            <div class="menu-section-title">Satış</div>
            <div class="menu-item" onclick="toggleSubmenu('salesSubmenu')">
                <i class="fas fa-handshake"></i>
                <span>Teklifler</span>
                <i class="fas fa-chevron-right arrow"></i>
            </div>
            <div id="salesSubmenu" class="submenu">
                <div class="submenu-item" onclick="showPage('teklifHazirla')">Teklif Hazırla</div>
                <div class="submenu-item" onclick="showPage('teklifListesi')">Teklifler Listesi</div>
            </div>
            <div class="menu-item" onclick="showPage('firmalar')">
                <i class="fas fa-building"></i>
                <span>Firmalar</span>
            </div>
        </div>

        <div class="menu-section">
            <div class="menu-section-title">Ürün Yönetimi</div>
            <div class="menu-item" onclick="showPage('urunAgaci')">
                <i class="fas fa-boxes"></i>
                <span>Ürün Ağacı</span>
            </div>
            <div class="menu-item" onclick="showPage('urunReceteleri')">
                <i class="fas fa-sitemap"></i>
                <span>Ürün Reçeteleri</span>
            </div>
        </div>

        <div class="menu-section">
            <div class="menu-section-title">Üretim Yönetimi</div>
            <div class="menu-item" onclick="toggleSubmenu('productionSubmenu')">
                <i class="fas fa-cogs"></i>
                <span>Üretim Yönetimi</span>
                <i class="fas fa-chevron-right arrow"></i>
            </div>
            <div id="productionSubmenu" class="submenu">
                <div class="submenu-item" onclick="showPage('isEmriVer')">İş Emri Ver</div>
                <div class="submenu-item" onclick="showPage('uretimTakip')">Üretim Takip</div>
                <div class="submenu-item" onclick="showPage('uretimListesi')">Üretim Listesi</div>
            </div>
        </div>

        <div class="menu-section">
            <div class="menu-section-title">Operasyon</div>
            <div class="menu-item" onclick="showPage('depo')">
                <i class="fas fa-warehouse"></i>
                <span>Depo Yönetimi</span>
            </div>
            <div class="menu-item" onclick="toggleSubmenu('sevkiyatSubmenu')">
                <i class="fas fa-truck"></i>
                <span>Sevkiyat</span>
                <i class="fas fa-chevron-right arrow"></i>
            </div>
            <div id="sevkiyatSubmenu" class="submenu">
                <div class="submenu-item" onclick="showPage('sevkiyatBekleyen')">
                    <i class="fas fa-clock" style="margin-right: 8px; font-size: 12px;"></i>Sevk Bekleyen
                </div>
                <div class="submenu-item" onclick="showPage('sevkiyatEdilen')">
                    <i class="fas fa-check-circle" style="margin-right: 8px; font-size: 12px;"></i>Sevk Edilen
                </div>
            </div>
            <div class="menu-item" onclick="showPage('raporlar')">
                <i class="fas fa-chart-bar"></i>
                <span>Raporlar</span>
            </div>
        </div>

        <div class="menu-section" id="adminSection" style="display: none;">
    <div class="menu-section-title">Yönetim</div>
    <div class="menu-item" onclick="showPage('admin')">
        <i class="fas fa-shield-alt"></i>
        <span>Admin Panel</span>
    </div>
    <div class="menu-item" onclick="showPage('kullaniciAktiviteleri')">
        <i class="fas fa-user-clock"></i>
        <span>Kullanıcı Aktiviteleri</span>
    </div>
    
        <div class="menu-item" onclick="showPage('insanKaynaklari')">
        <i class="fas fa-users"></i>
        <span>İnsan Kaynakları</span>
    </div>
</div>
    </nav>
</aside>

            <!-- MAIN CONTENT -->
            <main class="main-content">
                <div id="pageContent">
                    <!-- Page content will be loaded here -->
                </div>
            </main>
        </div>
    </div>

    <!-- MODALS -->
    <div id="productModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">Ürün Detayları</h3>
                <button class="modal-close" onclick="closeModal('productModal')">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body" id="productModalBody">
                <!-- Product details will be loaded here -->
            </div>
            <div class="modal-footer">
                <button class="btn btn-outline" onclick="closeModal('productModal')">Kapat</button>
            </div>
        </div>
    </div>

    <!-- Bildirim Modalı - Diğer modalların yanına eklenecek -->
<div id="notificationModal" class="modal">
    <div class="modal-content" style="max-width: 600px;">
        <div class="modal-header">
            <h3 class="modal-title">
                <i class="fas fa-bell"></i> Bildirimler
                <span id="unreadCount" style="background: var(--danger); color: white; padding: 2px 8px; border-radius: 12px; font-size: 14px; margin-left: 10px;"></span>
            </h3>
            <button class="modal-close" onclick="closeModal('notificationModal')">
                <i class="fas fa-times"></i>
            </button>
        </div>
        <div class="modal-body" style="max-height: 500px; overflow-y: auto;">
            <div class="notification-filters" style="margin-bottom: 20px; display: flex; gap: 10px;">
                <button class="btn btn-sm btn-outline" onclick="filterNotifications('all')">Tümü</button>
                <button class="btn btn-sm btn-outline" onclick="filterNotifications('unread')">Okunmamış</button>
                <button class="btn btn-sm btn-outline" onclick="filterNotifications('production')">Üretim</button>
                <button class="btn btn-sm btn-outline" onclick="markAllAsRead()">
                    <i class="fas fa-check-double"></i> Tümünü Okundu İşaretle
                </button>
            </div>
            <div id="notificationsList">
                <!-- Bildirimler buraya yüklenecek -->
            </div>
        </div>
    </div>
</div>

    <div id="userModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title" id="userModalTitle">Kullanıcı Ekle</h3>
                <button class="modal-close" onclick="closeModal('userModal')">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body">
                <form id="userForm">
                    <div class="form-group">
                        <label class="form-label">Ad Soyad</label>
                        <input type="text" class="form-control" id="userFormName" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Kullanıcı Adı</label>
                        <input type="text" class="form-control" id="userFormUsername" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Şifre</label>
                        <input type="password" class="form-control" id="userFormPassword" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Departman</label>
                        <select class="form-control" id="userFormRole" required>
                            <option value="">Seçiniz...</option>
                            <option value="admin">Yönetici</option>
                            <option value="sales">Satış</option>
                            <option value="production">Üretim</option>
                            <option value="warehouse">Depo</option>
                            <option value="logistics">Lojistik</option>
                            <option value="quality">Kalite Kontrol</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Yetkiler</label>
                        <div style="display: grid; gap: 12px;">
                            <label style="display: flex; align-items: center; gap: 8px;">
                                <input type="checkbox" id="perm_sales"> Satış Modülü
                            </label>
                            <label style="display: flex; align-items: center; gap: 8px;">
                                <input type="checkbox" id="perm_production"> Üretim Modülü
                            </label>
                            <label style="display: flex; align-items: center; gap: 8px;">
                                <input type="checkbox" id="perm_warehouse"> Depo Modülü
                            </label>
                            <label style="display: flex; align-items: center; gap: 8px;">
                                <input type="checkbox" id="perm_reports"> Raporlar
                            </label>
                            <label style="display: flex; align-items: center; gap: 8px;">
                                <input type="checkbox" id="perm_admin"> Admin Yetkileri
                            </label>
                        </div>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button class="btn btn-success" onclick="saveUser()">
                    <i class="fas fa-save"></i> Kaydet
                </button>
                <button class="btn btn-outline" onclick="closeModal('userModal')">İptal</button>
            </div>
        </div>
    </div>

   
<!-- Production Detail Modal -->
<div id="productionDetailModal" class="modal">
    <div class="modal-content">
        <div class="modal-header">
            <h3 class="modal-title" id="productionDetailTitle">Üretim Detayı</h3>
            <button class="modal-close" onclick="closeModal('productionDetailModal')">
                <i class="fas fa-times"></i>
            </button>
        </div>
        <div class="modal-body" id="productionDetailBody">
            <!-- Dynamic content -->
        </div>
        <div class="modal-footer">
    <button class="btn btn-success" onclick="saveProductionDetail()">
        <i class="fas fa-save"></i> Kaydet
    </button>
    <button class="btn btn-outline" onclick="closeModal('productionDetailModal')">Kapat</button>
</div>
    </div>
</div>


<!-- Recipe Modal -->
<div id="recipeModal" class="modal">
    <div class="modal-content">
        <div class="modal-header">
            <h3 class="modal-title" id="recipeModalTitle">Yeni Reçete</h3>
            <button class="modal-close" onclick="closeModal('recipeModal')">
                <i class="fas fa-times"></i>
            </button>
        </div>
        <div class="modal-body">
            <div class="form-grid">
                <div class="form-group">
                    <label class="form-label">Reçete Adı</label>
                    <input type="text" class="form-control" id="recipeName" placeholder="Reçete adı" required>
                </div>
                <div class="form-group">
                    <label class="form-label">Ürün Seçimi</label>
                    <select class="form-control" id="recipeProduct" required>
                        <option value="">Ürün seçiniz...</option>
                        ${firebaseData.products.map(p => `<option value="${p.id}">${p.name}</option>`).join('')}
                    </select>
                </div>
                <div class="form-group">
                    <label class="form-label">Hammaddeler</label>
                    <select multiple class="form-control" id="recipeRawMaterials" style="height: 150px;">
                        ${firebaseData.stock.map(s => `<option value="${s.id}">${s.name} (${s.quantity} ${s.unit})</option>`).join('')}
                    </select>
                    <p style="font-size: 12px; color: var(--gray-500);">Ctrl basılı tutarak birden fazla seçebilirsiniz.</p>
                </div>
                <div class="form-group">
                    <label class="form-label">Birim Başına Miktar</label>
                    <input type="number" class="form-control" id="recipeQuantityPerUnit" placeholder="Birim ürün için hammadde miktarı" value="1" min="1" required>
                </div>
            </div>
            <input type="hidden" id="recipeId">
        </div>
        <div class="modal-footer">
            <button class="btn btn-success" onclick="saveRecipe()">Kaydet</button>
            <button class="btn btn-outline" onclick="closeModal('recipeModal')">Kapat</button>
        </div>
    </div>
</div>
    <!-- NOTIFICATION -->
    <div id="notification" class="notification">
        <div class="notification-icon">
            <i class="fas fa-check"></i>
        </div>
        <div class="notification-content">
            <div class="notification-title">İşlem Başarılı</div>
            <div class="notification-message">İşleminiz başarıyla tamamlandı.</div>
        </div>
    </div>

  <!-- Firma Seçimi Modalı -->
<div id="companySelectionModal" class="modal">
    <div class="modal-content company-selection-modal">
        <div class="modal-header">
            <h2 class="modal-title">Firma Seçimi</h2>
            <button class="close-btn" onclick="closeModal('companySelectionModal')">&times;</button>
        </div>
        <div class="modal-body">
            <div class="search-section">
                <input type="text" id="companySelectionSearch" placeholder="Firma adı ara..." onkeyup="filterCompanySuggestions()">
            </div>
            <div class="suggestions-section">
                <h4>Önerilen Firmalar</h4>
                <ul id="companySuggestionsList" class="suggestions-list"></ul>
            </div>
            <div class="add-new-section">
                <button class="btn btn-primary" onclick="openModal('addCompanyModal')">Yeni Firma Ekle</button>
            </div>
        </div>
    </div>
</div>

<!-- Firma Ekle Modalı (Mevcut ama geliştirildi) -->
<div id="addCompanyModal" class="modal">
    <div class="modal-content">
        <div class="modal-header">
            <h2 class="modal-title">Firma Ekle</h2>
            <button class="close-btn" onclick="closeModal('addCompanyModal')">&times;</button>
        </div>
        <div class="modal-body">
            <form id="addCompanyForm">
                <div class="form-grid">
                    <div class="form-group">
                        <label>Firma Adı</label>
                        <input type="text" id="companyName" required>
                    </div>
                    <div class="form-group">
                        <label>Vergi No</label>
                        <input type="text" id="companyTaxNo" required>
                    </div>
                    <div class="form-group">
                        <label>Telefon</label>
                        <input type="tel" id="companyPhone">
                    </div>
                    <div class="form-group">
                        <label>E-posta</label>
                        <input type="email" id="companyEmail">
                    </div>
                    <div class="form-group">
                        <label>Web Sitesi</label>
                        <input type="url" id="companyWebsite">
                    </div>
                    <div class="form-group">
                        <label>Adres</label>
                        <textarea id="companyAddress"></textarea>
                    </div>
                    <div class="form-group">
                        <label>Müşteri Tipi</label>
                        <select id="companyType">
                            <option value="Normal Müşteri">Normal Müşteri</option>
                            <option value="Potansiyel Müşteri">Potansiyel Müşteri</option>
                            <option value="VIP Müşteri">VIP Müşteri</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>E-posta Bildirimlerini Kabul Ediyor</label>
                        <input type="checkbox" id="companyEmailNotifications">
                    </div>
                    <div class="form-group">
                        <label>Sık Kullanılanlara Ekle</label>
                        <input type="checkbox" id="companyFavorite">
                    </div>
                    <div class="form-group">
                        <label>Fotoğraf Yükle (Opsiyonel)</label>
                        <input type="file" id="companyPhoto" accept="image/*">
                    </div>
                </div>
            </form>
        </div>
        <div class="modal-footer">
            <button class="btn btn-success" onclick="saveCompany()">Kaydet</button>
            <button class="btn btn-outline" onclick="closeModal('addCompanyModal')">İptal</button>
        </div>
    </div>
</div>

    <!-- Offer Preview Modal -->
   
<div id="offerPreviewModal" class="modal">
    <div class="modal-content" style="max-width: 900px; max-height: 90vh; overflow-y: auto;">
        <div class="modal-header">
            <h3 class="modal-title">Teklif Önizleme</h3>
            <button class="modal-close" onclick="closeModal('offerPreviewModal')">
                <i class="fas fa-times"></i>
            </button>
        </div>
        <div class="modal-body" id="offerPreviewBody" style="padding: 0;">
            <!-- Preview content will be loaded here - Dinamik -->
        </div>
        <div class="modal-footer">
            <button class="btn btn-primary" onclick="printOffer()">
                <i class="fas fa-print"></i> Yazdır
            </button>
            <button class="btn btn-outline" onclick="closeModal('offerPreviewModal')">Kapat</button>
        </div>
    </div>
</div>

    <!-- ===== FIREBASE SCRIPTS ===== -->
    <!-- Firebase v9.23 CDN -->
    <script type="module">
        // Firebase imports - bu kısım firebase-config.js dosyasında olacak
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/9.23.0/firebase-app.js';
        import { getFirestore } from 'https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore.js';
        
        // Firebase konfigürasyonu test edilecek
        window.testFirebaseConnection = async function() {
            try {
                const firebaseStatus = document.getElementById('firebaseStatus');
                const firebaseStatusText = document.getElementById('firebaseStatusText');
                
                firebaseStatus.style.display = 'block';
                firebaseStatus.style.background = '#fff3cd';
                firebaseStatus.style.color = '#856404';
                firebaseStatusText.textContent = 'Firebase bağlantısı kontrol ediliyor...';
                
                // Bu kısımda gerçek Firebase config test edilecek
                // Şu an için simülasyon
                setTimeout(() => {
                    firebaseStatus.style.background = '#d4edda';
                    firebaseStatus.style.color = '#155724';
                    firebaseStatusText.textContent = 'Firebase bağlantısı başarılı!';
                    
                    setTimeout(() => {
                        firebaseStatus.style.display = 'none';
                    }, 2000);
                }, 1500);
                
            } catch (error) {
                console.error('Firebase connection test failed:', error);
                const firebaseStatus = document.getElementById('firebaseStatus');
                const firebaseStatusText = document.getElementById('firebaseStatusText');
                
                firebaseStatus.style.background = '#f8d7da';
                firebaseStatus.style.color = '#721c24';
                firebaseStatusText.textContent = 'Firebase bağlantı hatası!';
            }
        };
        
        // Sayfa yüklendiğinde Firebase test et
        document.addEventListener('DOMContentLoaded', function() {
            window.testFirebaseConnection();
        });
    </script>
    
    <!-- Ana script dosyası -->
    <script type="module" src="firebase-config.js"></script>
    <script type="module" src="script.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
    
    <!-- Bounce animasyonu için CSS -->
    <style>
        @keyframes bounce {
            0%, 80%, 100% {
                transform: scale(0);
            }
            40% {
                transform: scale(1);
            }
        }
        
        #firebaseLoadingOverlay {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', system-ui, sans-serif;
        }
        
        .firebase-sync-indicator {
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.5; }
            100% { opacity: 1; }
        }
    </style>
</body>
</html>